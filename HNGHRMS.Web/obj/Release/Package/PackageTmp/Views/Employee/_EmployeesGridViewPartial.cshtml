@{
	var grid = Html.DevExpress().GridView(settings => {
        settings.Name = "EmployeesGridView";
        settings.CallbackRouteValues = new { Controller = "Employee", Action = "EmployeesGridViewPartial" };

		settings.SettingsEditing.AddNewRowRouteValues = new { Controller = "Employee", Action = "EmployeesGridViewPartialAddNew" };
        settings.SettingsEditing.UpdateRowRouteValues = new { Controller = "Employee", Action = "EmployeesGridViewPartialUpdate" };
        settings.SettingsEditing.DeleteRowRouteValues = new { Controller = "Employee", Action = "EmployeesGridViewPartialDelete" };
        settings.SettingsEditing.Mode = GridViewEditingMode.EditFormAndDisplayRow;
        settings.SettingsBehavior.ConfirmDelete = true;

		settings.CommandColumn.Visible = true;
        settings.CommandColumn.ShowNewButton = true;
        settings.SettingsCommandButton.NewButton.Text = "Thêm";
        settings.SettingsCommandButton.EditButton.Text = "Sửa";
        settings.SettingsCommandButton.DeleteButton.Text = "Xóa";
        settings.CommandColumn.ShowDeleteButton = true;
        settings.CommandColumn.ShowEditButton = true;
        settings.CommandColumn.Width = 100;
		settings.KeyFieldName = "EmployeeId";

		settings.SettingsPager.Visible = true;
		settings.Settings.ShowGroupPanel = true;
		settings.Settings.ShowFilterRow = true;
		settings.SettingsBehavior.AllowSelectByRowClick = true;

        settings.Columns.Add(col => {
            col.FieldName = "EmployeeId";
            col.EditFormSettings.Visible = DefaultBoolean.False;
        });
				settings.Columns.Add("Name");
				settings.Columns.Add(col =>{
                    col.FieldName = "Gender";
                    col.ColumnType = MVCxGridViewColumnType.ComboBox;
                    ComboBoxProperties comboBoxPro = col.PropertiesEdit as ComboBoxProperties;
                    comboBoxPro.DataSource = new SelectList(new[]{
                        new SelectListItem{Text = "Nam",Value=HNGHRMS.Model.Enums.Gender.Male.ToString()},
                        new SelectListItem{Text = "Nữ", Value=HNGHRMS.Model.Enums.Gender.Female.ToString()}
                    },"Value","Text");
                });
				settings.Columns.Add("Address");
                settings.Columns.Add(col => {
                    col.FieldName = "JoinedDate";
                    col.ColumnType = MVCxGridViewColumnType.DateEdit;
                    col.PropertiesEdit.DisplayFormatString = "dd/MM/yyyy";
                    DateEditProperties dateEditPro = col.PropertiesEdit as DateEditProperties;
                    //dateEditPro.EditFormatString = "dd/MM/yyyy";                                        
                });
                settings.Columns.Add(col => {                                     
                    col.FieldName = "CompanyId";
                    col.ColumnType = MVCxGridViewColumnType.ComboBox;
                    ComboBoxProperties comboBoxPro= col.PropertiesEdit as ComboBoxProperties;
                    comboBoxPro.DataSource = ViewBag.Companies;
                    comboBoxPro.ValueType = typeof(int);                    
                });
        
                settings.CellEditorInitialize = (sender, e) => { 
                    if((sender as MVCxGridView).IsNewRowEditing)
                    {
                        if(e.Column.FieldName == "CompanyId" || e.Column.FieldName == "Gender" )
                        {
                            (e.Editor as ASPxComboBox).SelectedIndex = 0;
                        }
                        if(e.Column.FieldName == "JoinedDate")
                        {
                            (e.Editor as ASPxDateEdit).Date = DateTime.Now;
                        }
                    }
                };
				settings.Columns.Add("Departement");
				settings.Columns.Add("Position");            
                settings.Columns.Add(col => {
                    col.FieldName = "Salary";
                    col.PropertiesEdit.DisplayFormatString = "c0";                    
                    col.ColumnType = MVCxGridViewColumnType.TextBox;
                    TextBoxProperties textBoxPro = col.PropertiesEdit as TextBoxProperties;
                    textBoxPro.DisplayFormatString = "c0";
                    textBoxPro.MaskSettings.Mask = "<0..999999999g>.<00..99>";
                    textBoxPro.MaskSettings.IncludeLiterals = MaskIncludeLiteralsMode.DecimalSymbol;
                });
                settings.Columns.Add(col => {
                    col.FieldName = "Status";
                    col.ColumnType = MVCxGridViewColumnType.ComboBox;
                    ComboBoxProperties cmbPro = col.PropertiesEdit as ComboBoxProperties;
                    cmbPro.DataSource = new SelectList(new[]{
                        new SelectListItem(){Text ="Đang làm việc",Value = HNGHRMS.Model.Enums.EmployeeStatus.Present.ToString()},
                        new SelectListItem(){Text ="Đã nghỉ việc",Value = HNGHRMS.Model.Enums.EmployeeStatus.Terminated.ToString()},
                    },"Value","Text");
                    col.ReadOnly =true;
                    col.EditFormSettings.Visible = DefaultBoolean.True;
                });
			});
		if (ViewData["EditError"] != null){
        grid.SetEditErrorText((string)ViewData["EditError"]);
    }
}
@grid.Bind(Model).GetHtml()